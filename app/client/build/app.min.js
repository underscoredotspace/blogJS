function authService(t,e,o,n,r){const l="/api/user";return{login:function(e){const r={url:`${l}/login`,method:"POST",data:{code:e},headers:{"Content-Type":"application/json"}};return t(r).then(t=>(n.$broadcast("auth-status"),o.resolve(t)))},logout:function(){return e.remove("qqBlog"),t.get(`${l}/logout`).then(t=>(n.$broadcast("auth-status"),o.resolve(t)))},isLoggedIn:function(){return"localhost"===r.host()||angular.isDefined(e.get("qqBlog"))}}}angular.module("colonApp",["ngRoute","ngCookies","ng-showdown"]),angular.module("colonApp").constant("showdown",window.showdown).constant("hljs",window.hljs),function(){function t(t,n,r,l){e(t),o(n,r,l)}function e(t){t.when("/about",{templateUrl:"part/about.html"}).when("/home",{templateUrl:"part/posts.html",controller:"post",controllerAs:"vm"}).when("/home/:page",{templateUrl:"part/posts.html",controller:"post",controllerAs:"vm"}).when("/post/:id",{templateUrl:"part/posts.html",controller:"post",controllerAs:"vm"}).when("/new",{templateUrl:"part/newpost.html",controller:"new",controllerAs:"vm"}).when("/edit/:id",{templateUrl:"part/newpost.html",controller:"edit",controllerAs:"vm"}).when("/draft/:id",{templateUrl:"part/newpost.html",controller:"draft",controllerAs:"vm"}).when("/login",{templateUrl:"part/login.html",controller:"login",controllerAs:"vm"}).when("/logout",{template:"",controller:"logout"}).when("/setup/",{templateUrl:"part/setup.html",controller:"setup",controllerAs:"vm"}).otherwise({redirectTo:"/home"})}function o(t,e,o){e.extension("codehighlight",function(){function t(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}return[{type:"output",filter:function(n,r,l){const[c,a]=["<code\\b[^>]*>","</code>"];return e.helper.replaceRecursiveRegExp(n,function(e,n,r,l){return n=t(n),`${r}${o.highlightAuto(n).value}${l}`},c,a,"g")}}]}),t.loadExtension("codehighlight")}angular.module("colonApp").config(t),t.$inject=["$routeProvider","$showdownProvider","showdown","hljs"]}(),function(){function t(t,e){const o=this;o.loggedin=e.isLoggedIn(),t.$on("auth-status",()=>{o.loggedin=e.isLoggedIn()})}angular.module("colonApp").controller("blogController",t),t.$inject=["$rootScope","authService"]}(),function(){function t(t,e){e.isLoggedIn()&&e.logout().catch(console.error),t.path("/home")}angular.module("colonApp").controller("logout",t),t.$inject=["$location","authService"]}(),function(){function t(t,e,o,n){const r=this;let l,c;if(angular.isDefined(t.id)){const o=/[0-9a-fA-F]{24}/i;o.test(t.id)?l=t.id:e.path("/home")}angular.isDefined(t.page)&&(c=Number(t.page)),n.get({id:l,page:c}).then(t=>{r.blogposts=t.posts,l||(c||(c="1"),t.more&&(r.next=Number(c)+1),Number(c)>1&&(r.prev=Number(c)-1))}).catch(t=>console.error),r.postDelete=(t=>{n.delete(t).then(()=>{r.blogposts=o("filter")(r.blogposts,{_id:"!"+t}),e.path("/home")}).catch(console.error)}),r.postEdit=(t=>{e.path(`/edit/${t}`)})}angular.module("colonApp").controller("post",t),t.$inject=["$routeParams","$location","$filter","blogService"]}(),function(){function t(t,e,o,n){const r=this;if(!e.isLoggedIn())return t.path("/login");r.blogpost={date:new Date},n.init().then(()=>{r.saveDraft=(e=>{n.save(e).then(e=>t.path("/draft/"+e)).catch(console.error)})}),r.submitPost=(e=>{o.new(e).then(e=>t.path("/post/"+e)).catch(console.error)})}angular.module("colonApp").controller("new",t),t.$inject=["$location","authService","blogService","localDraft"]}(),function(){function t(t,e,o,n,r){const l=this;if(console.log("hello"),!o.isLoggedIn())return r.path("/login");const c=n.id;t.init().then(()=>{l.draftsEnabled=!0,t.load(c).then(t=>{console.log(t),l.blogpost=t}).catch(console.error),l.saveDraft=(e=>{t.save(e).then(t=>r.path("/draft/"+t)).catch(console.error)})}).catch(console.error)}angular.module("colonApp").controller("draft",t),t.$inject=["localDraft","blogService","authService","$routeParams","$location"]}(),function(){function t(t,e,o,n,r){const l=this;if(!e.isLoggedIn())return r.path("/login");if(!/^[a-f\d]{24}$/i.test(n.id))return r.path("/home");const c=n.id;o.init().then(()=>{l.draftsEnabled=!0,l.saveDraft=(t=>{o.save(t).then(t=>r.path("/draft/"+t)).catch(console.error)})}).catch(console.error),t.get({id:c}).then(t=>{l.blogpost=t.posts[0]}).catch(console.error),l.submitPost=(e=>{t.edit(c,e).then(t=>r.path("/post/"+t)).catch(console.error)})}angular.module("colonApp").controller("edit",t),t.$inject=["blogService","authService","localDraft","$routeParams","$location"]}(),function(){function t(t,e,o){const n=this;if(o.$broadcast("auth-status"),e.isLoggedIn())return t.path("/home");n.login=function(o){e.login(o).then(()=>{t.path("/home")}).catch(console.error)}}angular.module("colonApp").controller("login",t),t.$inject=["$location","authService","$rootScope"]}(),function(){function t(t,e){let o="/api/blog";return{get:function({id:e,page:n}={}){let r=o;return n?r+=`/${n}`:e&&(r+=`/id/${e}`),t({method:"get",url:r,headers:{"Content-Type":"application/json"}}).then(t=>t.data)},delete:function(n){if(!angular.isDefined(n))return e.reject("Post ID required");const r={method:"delete",url:`${o}/${n}`,headers:{"Content-Type":"application/json"}};return t(r)},edit:function(n,r){if(!angular.isDefined(n))return e.reject("Post ID required");if(!angular.isDefined(r))return e.reject("Edited post required");if(r.title.length<5||r.content.length<5)return e.reject("Title or content too short");const l={method:"PATCH",url:`${o}/${n}`,data:{blogpost:r},headers:{"Content-Type":"application/json"}};return t(l).then(t=>e.resolve(n))},new:function(n){return angular.isDefined(n)?n.title.length<5||n.content.length<5?e.reject("Title or content too short"):t({method:"POST",url:o,data:{blogpost:n},headers:{"Content-Type":"application/json"}}).then(t=>e.resolve(t.data.id)):e.reject("New post required")}}}angular.module("colonApp").service("blogService",t),t.$inject=["$http","$q"]}(),angular.module("colonApp").service("authService",authService),authService.$inject=["$http","$cookies","$q","$rootScope","$location"],function(){function t(t,e,o,n){const r=this;r.init=function(){t.printSetupCode().then(()=>r.step="1").catch(()=>o.path("/home"))},r.getQR=function(e){t.getQR(e).then(t=>{r.qr=n.trustAsHtml(t),r.step="2"}).catch(t=>console.error)},r.verify=function(e){t.verify(e).then(()=>{r.qr=void 0,r.step="3"}).catch(t=>console.error)}}angular.module("colonApp").controller("setup",t),t.$inject=["setupService","$routeParams","$location","$sce"]}(),function(){function t(t,e){const o="/api/setup";return{getQR:function(n){const r={url:`${o}/qr`,method:"POST",data:{code:n},headers:{"Content-Type":"application/json"}};return t(r).then(t=>angular.isDefined(t.data.qr)?e.resolve(t.data.qr):e.reject(0))},verify:function(e){const n={url:`${o}/verify`,method:"POST",data:{code:e},headers:{"Content-Type":"application/json"}};return t(n)},printSetupCode:function(){return t.get(`${o}/code`)}}}angular.module("colonApp").service("setupService",t),t.$inject=["$http","$q"]}(),function(){function t(t){function e(){return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/x/g,()=>{let t=(new Date).getTime();return t*=Math.random(),(t=Math.floor(t)%16).toString(16)})}let o;const n={load:function(e){if(!o)return t.reject("localStorage is not enabled");const n=localStorage.getItem(e),r=JSON.parse(n);return t.resolve(r)},save:function(n){if(!o)return t.reject("localStorage is not enabled");let r;return r=n.hasOwnProperty("_id")?n._id:e(),localStorage.setItem(r,JSON.stringify(n)),t.resolve(r)},init:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),o=!0,console.log("Drafts Service is enabled"),t.resolve(!0)}catch(e){return console.log("Drafts Service is disabled"),t.reject({localStorage:e})}},list:function(){if(!o)return t.reject("localStorage is not enabled");if(0===localStorage.length)return t.resolve([]);const e=[];for(let o=0;o<localStorage.length;o++)n.load(localStorage.key(o)).then(t=>e.push(t)).catch(t.reject);return t.resolve(e)},enabled:()=>o};return n}angular.module("colonApp").service("localDraft",t),t.$inject=["$q"]}();
//# sourceMappingURL=app.min.js.map