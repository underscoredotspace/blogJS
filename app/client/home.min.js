!function(){angular.module("colonApp",["ngRoute","ngCookies","ng-showdown"])}(),function(){function t(t,n){o(t),e(n)}function o(t){t.when("/about",{templateUrl:"part/about.html"}).when("/home",{templateUrl:"part/posts.html",controller:"home"}).when("/home/:page",{templateUrl:"part/posts.html",controller:"home"}).when("/post/:id",{templateUrl:"part/posts.html",controller:"post"}).when("/new",{templateUrl:"part/newpost.html",controller:"new"}).when("/edit/:id",{templateUrl:"part/newpost.html",controller:"edit"}).when("/login",{templateUrl:"part/login.html",controller:"login"}).when("/logout",{template:'<div class="part">Logging out...</div>',controller:"logout"}).when("/setup/",{templateUrl:"part/setup.html",controller:"setup"}).otherwise({redirectTo:"/home"})}function e(t){function o(){function t(t,e,n){var l=(t,e,n,l)=>{e=o(e);return n+window.hljs.highlightAuto(e).value+l};return window.showdown.helper.replaceRecursiveRegExp(t,l,"<code\\b[^>]*>","</code>","g")}const o=t=>t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">");return[{type:"output",filter:t}]}window.showdown.extension("codehighlight",o),t.loadExtension("codehighlight")}angular.module("colonApp").config(t),t.$inject=["$routeProvider","$showdownProvider"]}(),function(){function t(t){t.debugInfoEnabled(!1),t.commentDirectivesEnabled(!1)}angular.module("colonApp").config(t),t.$inject=["$compileProvider"]}(),function(){function t(t){const o=this;o.loggedin=!1,t.get("qqBlog")&&(o.loggedin=!0)}angular.module("colonApp").controller("blogController",t),t.$inject=["$cookies"]}(),function(){function t(){function t(t,o,e){const n=this;n.postDelete=function(l){t({method:"delete",url:"/api/post/"+l,headers:{"Content-Type":"application/json"}}).then(function(t){console.log("deleted",l),n.$parent.blogposts=o("filter")(n.$parent.blogposts,{_id:"!"+l}),e.path()==="/post/"+l&&e.path("/")}).catch(function(t,o){console.log(t),console.log(o)})},n.postEdit=function(t){console.log("edit",t),e.path("/edit/"+t)}}const o={restrict:"C",controller:t,controllerAs:"vm"};return t.$inject=["$http","$filter","$location"],o}angular.module("colonApp").directive("blogPost",t)}(),function(){function t(t,o,e){t.$parent.blog.loggedin?o.get("/api/logout").then(function(o){t.$parent.blog.loggedin=!1,e.path("/home")},function(o){console.error(o),t.$parent.blog.loggedin=!1,e.path("/home")}):e.path("/home")}angular.module("colonApp").controller("logout",t),t.$inject=["$scope","$http","$location"]}(),function(){function t(t,o){o.get(null,function(o,e){o?console.error(o):t.blogposts=e})}angular.module("colonApp").controller("home",t),t.$inject=["$scope","blog"]}(),function(){function t(t,o,e,n,l){function i(o,l){t.$parent.error=o,l&&n(function(){t.$parent.error=null,e.path("/home")},3e3)}/[0-9a-fA-F]{24}/i.test(o.id)?l.get(o.id,function(o,e){o?i("Error getting post"):204===e.status?i("Invalid post. Going home...",!0):t.blogposts=e}):i("Invalid post. Going home...",!0)}angular.module("colonApp").controller("post",t),t.$inject=["$scope","$routeParams","$location","$timeout","blogService"]}(),function(){function t(t,o,e){t.$parent.blog.loggedin?(t.blogpost={title:"",content:"",date:new Date},t.submitPost=function(){var n={title:t.blogpost.title,content:t.blogpost.content};o({url:"/api/new",method:"POST",data:{blogpost:n},headers:{"Content-Type":"application/json"}}).then(function(t){t.data.hasOwnProperty("ID")&&e.path("/post/"+t.data.ID)},function(t){console.error(t.data)})}):e.path("/login")}angular.module("colonApp").controller("new",t),t.$inject=["$scope","$http","$location"]}(),function(){function t(t,o,e,n,l){o.get(e.id,function(o,e){o?console.error(o):204===e.status?(console.info("Post doesn't exist"),n.path("/home")):t.blogpost=e[0]}),t.submitPost=function(){var o={title:t.blogpost.title,content:t.blogpost.content};l({url:"/api/post/"+e.id,method:"PATCH",data:{blogpost:o},headers:{"Content-Type":"application/json"}}).then(function(t){n.path("/post/"+e.id)},function(t){console.error(t.data)})}}angular.module("colonApp").controller("edit",t),t.$inject=["$scope","blogService","$routeParams","$location","$http"]}(),function(){function t(t,o,e){t.$parent.blog.loggedin?e.path("/home"):t.login=function(){o({url:"/api/login",method:"POST",data:{code:t.gaCode},headers:{"Content-Type":"application/json"}}).then(function(o){t.$parent.blog.loggedin=!0,e.path("/home")},function(t){console.error(t.data)})}}angular.module("colonApp").controller("login",t),t.$inject=["$scope","$http","$location"]}(),function(){function t(t,o,e){o({url:"/api/setup/adminCode",method:"GET"}).then(function(o){t.message="Check the server console to get your setup code"},function(o){console.error(o.data),t.message="Error getting setup code."}),t.step=1,t.getQR=function(){o({url:"/api/setup/QR",method:"POST",data:{code:t.setupCode},headers:{"Content-Type":"application/json"}}).then(function(o){o.data.hasOwnProperty("qr")&&(t.qr=e.trustAsHtml(o.data.qr),t.message="Scan the QR code with Google Authenticator and input the code to verify",t.adminCode=null,t.step=2)},function(o){o.data.verified?(t.message="You're already verified. If you lost the code in Google Authenticator, delete the admin collection in the database to start again",t.step=0):t.message="Error getting QR code. Restart blog on the server and come back to this page to generate a new setup code",console.error(o.data)})},t.verify=function(){o({url:"/api/setup/verify",method:"POST",data:{code:t.gaCode},headers:{"Content-Type":"application/json"}}).then(function(o){t.$parent.blog.loggedin=!0,t.qr=null,t.message=null,t.gaCode=null,t.step=3},function(o){t.message="Error verifying code. Try again with the next one. If this still doesn't work, delete the admin collection in the database and start again",console.error(o.data)})}}angular.module("colonApp").controller("setup",t),t.$inject=["$scope","$http","$sce"]}(),function(){function t(){return function(t){var o={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("en-GB",o)}}angular.module("colonApp").filter("niceDate",t)}(),function(){function t(t){return o=>t.trustAsHtml(o)}angular.module("colonApp").filter("trustHTML",t),t.$inject=["$sce"]}(),function(){function t(t,o){return{get:function(o,e){const n=this;var l;l=o?"post/"+o:"latest/5",t.get("/api/"+l).then(function(t){if(204===t.status){console.warn("no posts yet!");const t=[{title:"Welcome",content:'This is your blog. Make a <a href="/#!/new">post</a>. ',date:new Date}];e(null,t)}else n.convertMD(t.data,function(t){e(null,t)})}).catch(function(t){e(t)})},convertMD:function(t,e){t.forEach(function(t,e){t.contentHTML=o.makeHtml(t.content)}),e(t)}}}angular.module("colonApp").service("blogService",t),t.$inject=["$http","$showdown"]}();